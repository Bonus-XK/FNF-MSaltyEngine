#å­©å­ä»¬å¤ªæ— èŠäº†ï¼Œå†³å®šå†æŠ½è±¡ä¸€æ¬¡ğŸ’€
name: Base-Build

on: 
  workflow_call:
    inputs:
      name:
        required: true
        type: string
      run-os:
        required: true
        type: string
      cache-key:
        required: true
        type: string
      cache-path:
        required: false
        type: string
      upload-key:
        required: true
        type: string
      upload-path:
        required: true
        type: string
      build-os:
        required: true
        type: string

env:
  build-name: æˆ‘ä¸çŸ¥é“

jobs:
  YuanShenQiDong:
    name: åŸç¥å¯åŠ¨
    runs-on: ${{inputs.runOS}}
    steps:
      - name: æŠŠä½ çš„ç²¾åçš„æ¶²ä½“è¾“å…¥åˆ°è¿™é‡Œ(checkout)
        uses: actions/checkout@main

      - name: å®‰è£…äººå·¥å­å®«æ–¹ä¾¿æäº‹(setup haxe)
        uses: krdlab/setup-haxe@v1
        with:
          haxe-version: 4.2.5

      - name: å®‰è£…äººå·¥è¾“ç²¾æ¶²(setup hxLibrary path)
        run: |
          mkdir .haxelib
          cd .haxelib

      - name: ä¼ å®—æ¥ä»£ï¼Œå­å­å­™å­™æ— ç©·æ— å°½ä¹Ÿ(cache)
        uses: actions/cache@v3
        with:
          key: do you like what you see? ${{inputs.cache-key}}
          path: |
            .haxelib/
            export/release/${{inputs.build-os}}/haxe/
             export/release/${{inputs.build-os}}/obj/
          restore-keys: |
            do you like what you see? ${{inputs.cache-key}}

      - name: ä¸ºä½ çš„è¿ªå…‹è£…è½½æ‰€éœ€çš„ç²¾å(dddd)
        run: |
          haxelib install hmm --quiet
          haxelib run hmm install --quiet

      - name: æœ€åä¸€æ­¥ï¼Œå°†ç²¾åæ¶²ä½“å°„å…¥åˆ°é˜´æˆ·é‡Œ(compile and build game)
        run: |
          haxelib run lime build ${{inputs.build-os}}

      - name: æœ€æœ€åä¸€æ­¥ï¼Œä½ ä»¬éƒ½çŸ¥é“(upload)
        uses: actions/upload-artifact@main
        with:
          name: ${{env.build-game}}-${{ inputs.upload-key }}
          path: ${{ inputs.upload-path }}
          if-no-files-found: error
          
